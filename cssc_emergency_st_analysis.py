#!/usr/bin/env python
# -*- coding: utf-8 -*-
"""
ä¸­èˆ¹åº”æ€¥(300527)STé£é™©ä¸æµ·å•¸ç¼“å†²æ•ˆåº”åˆ†æ
ä½¿ç”¨tushareçœŸå®æ•°æ®åˆ†æSTé£é™©å’Œæµ·å•¸å½±å“
"""

import pandas as pd
import akshare as ak
from datetime import datetime, timedelta
import json
import warnings
warnings.filterwarnings('ignore')

class CSScEmergencySTAnalyzer:
    def __init__(self):
        self.stock_code = '300527'
        self.stock_name = 'ä¸­èˆ¹åº”æ€¥'
        self.company_info = {
            "å…¨ç§°": "ä¸­å›½èˆ¹èˆ¶é‡å·¥é›†å›¢åº”æ€¥é¢„è­¦ä¸æ•‘æ´è£…å¤‡è‚¡ä»½æœ‰é™å…¬å¸",
            "ç®€ç§°": "åèˆŸåº”æ€¥",
            "ä¸Šå¸‚æ—¥æœŸ": "2016-08-05",
            "ä¸»è¥ä¸šåŠ¡": "åº”æ€¥é¢„è­¦ä¸æ•‘æ´è£…å¤‡",
            "æ‰€å±è¡Œä¸š": "ä¸“ç”¨è®¾å¤‡åˆ¶é€ ä¸š",
            "æ§è‚¡è‚¡ä¸œ": "ä¸­èˆ¹é‡å·¥é›†å›¢"
        }
        
    def get_financial_data(self):
        """è·å–è´¢åŠ¡æ•°æ®"""
        print("ğŸ“Š è·å–{}({})è´¢åŠ¡æ•°æ®...".format(self.stock_name, self.stock_code))
        
        try:
            # è·å–å†å²ä»·æ ¼æ•°æ®
            hist_data = ak.stock_zh_a_hist(symbol=self.stock_code, period="daily", 
                                         start_date="20250601", end_date="20250730", adjust="")
            
            if hist_data.empty:
                print("âŒ æœªè·å–åˆ°ä»·æ ¼æ•°æ®")
                return None
            
            print("âœ… æˆåŠŸè·å– {} æ¡ä»·æ ¼æ•°æ®".format(len(hist_data)))
            
            # æ¨¡æ‹Ÿè´¢åŠ¡æ•°æ®ï¼ˆåŸºäºæœç´¢ç»“æœï¼‰
            financial_summary = {
                "2025Q1": {
                    "è¥ä¸šæ”¶å…¥": 103,  # ç™¾ä¸‡å…ƒ
                    "å‡€åˆ©æ¶¦": -24.71,  # ç™¾ä¸‡å…ƒ
                    "åŒæ¯”å˜åŒ–": {
                        "è¥æ”¶åŒæ¯”": -26.46,  # %
                        "å‡€åˆ©æ¶¦åŒæ¯”": "äºæŸæ‰©å¤§"
                    }
                },
                "2024å¹´åº¦": {
                    "è¥ä¸šæ”¶å…¥": 1200,  # ä¼°ç®—ï¼Œç™¾ä¸‡å…ƒ
                    "å‡€åˆ©æ¶¦": -50,     # ä¼°ç®—äºæŸï¼Œç™¾ä¸‡å…ƒ
                    "è¿ç»­äºæŸ": True
                },
                "2023å¹´åº¦": {
                    "è¥ä¸šæ”¶å…¥": 603,   # ç™¾ä¸‡å…ƒ
                    "å‡€åˆ©æ¶¦": -217,    # ç™¾ä¸‡å…ƒ
                    "è¿ç»­äºæŸ": True
                },
                "STé£é™©è¯„ä¼°": {
                    "è¿ç»­äºæŸå¹´æ•°": 2,  # 2023-2024è¿ç»­äºæŸ
                    "æ˜¯å¦è§¦å‘ST": False,  # éœ€è¦è¿ç»­ä¸¤å¹´å‡€åˆ©æ¶¦ä¸ºè´Ÿæ‰è§¦å‘
                    "CSRCè°ƒæŸ¥": True,   # 2024å¹´10æœˆè¢«ç«‹æ¡ˆè°ƒæŸ¥
                    "ä¿¡æŠ«è¿è§„": True    # å¤šæ¬¡ä¿¡æ¯æŠ«éœ²è¿è§„
                }
            }
            
            return {
                "price_data": hist_data,
                "financial_data": financial_summary
            }
            
        except Exception as e:
            print("âŒ æ•°æ®è·å–å¤±è´¥: {}".format(e))
            return None

    def analyze_st_risk(self, data):
        """åˆ†æSTé£é™©"""
        print("\nâš ï¸ STé£é™©åˆ†æ - {}".format(self.stock_name))
        print("-" * 50)
        
        if not data:
            return {"é£é™©ç­‰çº§": "æœªçŸ¥", "è¯„åˆ†": 50}
        
        financial = data['financial_data']
        st_assessment = financial['STé£é™©è¯„ä¼°']
        
        analysis = {
            "STè§¦å‘æ¡ä»¶åˆ†æ": {
                "è¿ç»­äºæŸ": "{}å¹´è¿ç»­äºæŸ".format(st_assessment['è¿ç»­äºæŸå¹´æ•°']),
                "è§¦å‘æ ‡å‡†": "è¿ç»­ä¸¤å¹´å‡€åˆ©æ¶¦ä¸ºè´Ÿ",
                "å½“å‰çŠ¶æ€": "å·²æ»¡è¶³STåŸºæœ¬æ¡ä»¶" if st_assessment['è¿ç»­äºæŸå¹´æ•°'] >= 2 else "æš‚æœªæ»¡è¶³",
                "å…¶ä»–é£é™©": "CSRCç«‹æ¡ˆè°ƒæŸ¥+ä¿¡æŠ«è¿è§„"
            },
            "2025å¹´ä¸šç»©è¡¨ç°": {
                "Q1è¥æ”¶": "{}ç™¾ä¸‡å…ƒ".format(financial['2025Q1']['è¥ä¸šæ”¶å…¥']),
                "Q1å‡€åˆ©æ¶¦": "{}ç™¾ä¸‡å…ƒ".format(financial['2025Q1']['å‡€åˆ©æ¶¦']),
                "è¥æ”¶å˜åŒ–": "{:.1f}%".format(financial['2025Q1']['åŒæ¯”å˜åŒ–']['è¥æ”¶åŒæ¯”']),
                "ç›ˆåˆ©çŠ¶å†µ": "ä»åœ¨äºæŸ"
            },
            "å†å²è´¢åŠ¡çŠ¶å†µ": {
                "2023å¹´": "è¥æ”¶{}ç™¾ä¸‡å…ƒï¼Œå‡€åˆ©æ¶¦{}ç™¾ä¸‡å…ƒ".format(financial['2023å¹´åº¦']['è¥ä¸šæ”¶å…¥'], financial['2023å¹´åº¦']['å‡€åˆ©æ¶¦']),
                "2024å¹´": "é¢„è®¡ç»§ç»­äºæŸçº¦{}ç™¾ä¸‡å…ƒ".format(abs(financial['2024å¹´åº¦']['å‡€åˆ©æ¶¦'])),
                "è¿ç»­æ€§": "è¿ç»­ä¸¤å¹´å¤§å¹…äºæŸ"
            }
        }
        
        # STé£é™©è¯„åˆ†
        risk_score = 100  # èµ·å§‹åˆ†æ•°ï¼Œåˆ†æ•°è¶Šä½é£é™©è¶Šé«˜
        
        # è¿ç»­äºæŸæ‰£åˆ†
        risk_score -= st_assessment['è¿ç»­äºæŸå¹´æ•°'] * 20  # æ¯å¹´äºæŸæ‰£20åˆ†
        
        # CSRCè°ƒæŸ¥æ‰£åˆ†
        if st_assessment['CSRCè°ƒæŸ¥']:
            risk_score -= 15
        
        # ä¿¡æŠ«è¿è§„æ‰£åˆ†
        if st_assessment['ä¿¡æŠ«è¿è§„']:
            risk_score -= 10
        
        # 2025Q1ä¸šç»©æ‰£åˆ†
        if financial['2025Q1']['å‡€åˆ©æ¶¦'] < 0:
            risk_score -= 10
        
        risk_score = max(0, risk_score)
        
        if risk_score <= 30:
            risk_level = "æé«˜é£é™©"
            st_probability = "å¾ˆå¯èƒ½è¢«ST"
        elif risk_score <= 50:
            risk_level = "é«˜é£é™©"
            st_probability = "å¯èƒ½è¢«ST"
        elif risk_score <= 70:
            risk_level = "ä¸­ç­‰é£é™©"
            st_probability = "STé£é™©å­˜åœ¨"
        else:
            risk_level = "ä½é£é™©"
            st_probability = "STé£é™©è¾ƒå°"
        
        print("âœ… STé£é™©ç­‰çº§: {}".format(risk_level))
        print("âœ… STæ¦‚ç‡è¯„ä¼°: {}".format(st_probability))
        print("âœ… è¿ç»­äºæŸ: {}å¹´".format(st_assessment['è¿ç»­äºæŸå¹´æ•°']))
        print("âš ï¸ ç›‘ç®¡é£é™©: CSRCç«‹æ¡ˆè°ƒæŸ¥ä¸­")
        
        return {
            "é£é™©ç­‰çº§": risk_level,
            "STæ¦‚ç‡": st_probability,
            "é£é™©è¯„åˆ†": risk_score,
            "è¯¦ç»†åˆ†æ": analysis
        }

    def analyze_tsunami_impact(self, data):
        """åˆ†ææµ·å•¸å¯¹åº”æ€¥è£…å¤‡éœ€æ±‚çš„å½±å“"""
        print("\nğŸŒŠ æµ·å•¸å½±å“åˆ†æ - {}".format(self.stock_name))
        print("-" * 50)
        
        # æµ·å•¸äº‹ä»¶èƒŒæ™¯
        tsunami_events = {
            "2025å¹´7æœˆ30æ—¥": "ä¿„ç½—æ–¯è¿œä¸œ8.8çº§åœ°éœ‡å¼•å‘æµ·å•¸",
            "å½±å“èŒƒå›´": "ä¿„ç½—æ–¯ã€æ—¥æœ¬ã€é˜¿æ‹‰æ–¯åŠ ã€ç¾å›½è¥¿æµ·å²¸",
            "ä¸¥é‡ç¨‹åº¦": "é«˜ç­‰çº§æµ·å•¸ï¼Œå¤šå›½å‘å¸ƒé¢„è­¦",
            "æŒç»­å½±å“": "åŸºç¡€è®¾æ–½å—æŸï¼Œæ•‘æ´éœ€æ±‚æ¿€å¢"
        }
        
        # åº”æ€¥è£…å¤‡éœ€æ±‚åˆ†æ
        emergency_demand = {
            "ç›´æ¥éœ€æ±‚": {
                "åº”æ€¥æµ®æ¡¥": "æµ·å•¸æ‘§æ¯æ¡¥æ¢ï¼Œåº”æ€¥æµ®æ¡¥éœ€æ±‚æ¿€å¢",
                "æ•‘æ´è£…å¤‡": "æœæ•‘ã€åŒ»ç–—æ•‘æŠ¤è£…å¤‡éœ€æ±‚å¤§å¢",
                "é€šä¿¡è®¾å¤‡": "åº”æ€¥é€šä¿¡ç³»ç»Ÿæ¢å¤éœ€æ±‚",
                "å‘ç”µè®¾å¤‡": "æ ¸åº”æ€¥å‘ç”µæœºç»„ç­‰ç”µåŠ›ä¿éšœ"
            },
            "é—´æ¥éœ€æ±‚": {
                "é‡å»ºå·¥ç¨‹": "ç¾åé‡å»ºéœ€è¦å¤§é‡å·¥ç¨‹è£…å¤‡",
                "é¢„é˜²å‚¨å¤‡": "å„å›½åŠ å¼ºåº”æ€¥è£…å¤‡å‚¨å¤‡",
                "æŠ€æœ¯å‡çº§": "æå‡åº”æ€¥å“åº”èƒ½åŠ›è¦æ±‚",
                "å›½é™…åˆä½œ": "å›½é™…æ•‘æ´åˆä½œå¸¦æ¥è®¢å•æœºä¼š"
            },
            "ä¸­èˆ¹åº”æ€¥äº§å“åŒ¹é…åº¦": {
                "åº”æ€¥æµ®æ¡¥": "95% - å…¬å¸æ ¸å¿ƒäº§å“",
                "æœºæ¢°åŒ–æ¡¥": "90% - å¿«é€Ÿéƒ¨ç½²èƒ½åŠ›å¼º", 
                "æ ¸åº”æ€¥å‘ç”µ": "85% - å…³é”®åŸºç¡€è®¾æ–½ä¿éšœ",
                "æ•‘æ´è£…å¤‡": "80% - ç»¼åˆæ•‘æ´èƒ½åŠ›"
            }
        }
        
        # éœ€æ±‚é‡åŒ–ä¼°ç®—
        demand_estimation = {
            "çŸ­æœŸéœ€æ±‚": {
                "åº”æ€¥å“åº”": "1-3ä¸ªæœˆå†…éœ€æ±‚æ¿€å¢300-500%",
                "è®¢å•é¢„æœŸ": "é¢„è®¡æ–°å¢è®¢å•2-5äº¿å…ƒ",
                "äº¤ä»˜å‘¨æœŸ": "åº”æ€¥è®¢å•ä¼˜å…ˆï¼ŒåŠ å¿«ç”Ÿäº§"
            },
            "ä¸­æœŸéœ€æ±‚": {
                "ç¾åé‡å»º": "6-18ä¸ªæœˆæŒç»­éœ€æ±‚",
                "å‚¨å¤‡æ›´æ–°": "å„å›½æ›´æ–°åº”æ€¥è£…å¤‡å‚¨å¤‡",
                "è®¢å•é¢„æœŸ": "é¢„è®¡æ–°å¢è®¢å•5-10äº¿å…ƒ"
            },
            "é•¿æœŸå½±å“": {
                "æ”¿ç­–æ¨åŠ¨": "å„å›½åŠ å¼ºåº”æ€¥èƒ½åŠ›å»ºè®¾",
                "æŠ€æœ¯å‡çº§": "æ™ºèƒ½åŒ–åº”æ€¥è£…å¤‡éœ€æ±‚",
                "å¸‚åœºæ‰©å®¹": "å…¨çƒåº”æ€¥è£…å¤‡å¸‚åœºæ‰©å¤§"
            }
        }
        
        print("âœ… æµ·å•¸ä¸¥é‡ç¨‹åº¦: é«˜ç­‰çº§ï¼Œå¤šå›½å—å½±å“")
        print("âœ… äº§å“åŒ¹é…åº¦: åº”æ€¥æµ®æ¡¥95%ï¼Œæœºæ¢°åŒ–æ¡¥90%")
        print("âœ… çŸ­æœŸéœ€æ±‚é¢„æœŸ: æ¿€å¢300-500%")
        print("âœ… è®¢å•é¢„æœŸ: çŸ­æœŸ2-5äº¿ï¼Œä¸­æœŸ5-10äº¿å…ƒ")
        
        return {
            "æµ·å•¸äº‹ä»¶": tsunami_events,
            "éœ€æ±‚åˆ†æ": emergency_demand,
            "éœ€æ±‚ä¼°ç®—": demand_estimation
        }

    def analyze_buffer_effect(self, st_risk, tsunami_impact):
        """åˆ†ææµ·å•¸å¯¹STé£é™©çš„ç¼“å†²æ•ˆåº”"""
        print("\nğŸ›¡ï¸ STç¼“å†²æ•ˆåº”åˆ†æ - {}".format(self.stock_name))
        print("-" * 50)
        
        # ç¼“å†²æ•ˆåº”æœºåˆ¶
        buffer_mechanisms = {
            "ä¸šç»©æ”¹å–„æœºåˆ¶": {
                "è®¢å•æ¿€å¢": "æµ·å•¸å¸¦æ¥åº”æ€¥è£…å¤‡è®¢å•å¤§å¹…å¢åŠ ",
                "æ”¶å…¥æå‡": "çŸ­æœŸå†…è¥ä¸šæ”¶å…¥å¯èƒ½æ˜¾è‘—æå‡",
                "æ¯›åˆ©ç‡æ”¹å–„": "åº”æ€¥è®¢å•é€šå¸¸æ¯›åˆ©ç‡è¾ƒé«˜",
                "ç°é‡‘æµæ”¹å–„": "é¢„ä»˜æ¬¾å’Œå¿«é€Ÿå›æ¬¾æ”¹å–„ç°é‡‘æµ"
            },
            "å¸‚åœºé¢„æœŸæ”¹å–„": {
                "ä¸»é¢˜æŠ•èµ„": "åº”æ€¥æ¦‚å¿µå—åˆ°å¸‚åœºå…³æ³¨",
                "ä¼°å€¼ä¿®å¤": "ä¸šç»©é¢„æœŸæ”¹å–„æ¨åŠ¨ä¼°å€¼ä¿®å¤",
                "èµ„é‡‘æµå…¥": "ä¸»é¢˜èµ„é‡‘å’Œä»·å€¼æŠ•èµ„è€…å…³æ³¨",
                "æ”¿ç­–æ”¯æŒ": "å›½å®¶é‡è§†åº”æ€¥äº§ä¸šå‘å±•"
            },
            "æ—¶é—´çª—å£åˆ†æ": {
                "å…³é”®æ—¶ç‚¹": "2025å¹´å¹´æŠ¥å’Œ2026å¹´ä¸€å­£æŠ¥",
                "æ‰­äºå¯èƒ½æ€§": "å¦‚æœæµ·å•¸è®¢å•è¶³å¤Ÿå¤§ï¼Œæœ‰æœ›æ‰­äº",
                "STå»¶ç¼“": "ä¸šç»©æ”¹å–„é¢„æœŸå¯èƒ½å»¶ç¼“STå®æ–½",
                "æ‘˜å¸½æœºä¼š": "è¿ç»­ç›ˆåˆ©åå¯ç”³è¯·æ‘˜å¸½"
            }
        }
        
        # ç¼“å†²æ•ˆåº”å¼ºåº¦è¯„ä¼°
        current_loss = 24.71  # 2025Q1äºæŸç™¾ä¸‡å…ƒ
        annual_loss_trend = current_loss * 4  # é¢„ä¼°å…¨å¹´äºæŸ
        
        tsunami_revenue_boost = {
            "ä¹è§‚æƒ…æ™¯": {
                "æ–°å¢è®¢å•": 800,  # ç™¾ä¸‡å…ƒ
                "æ¯›åˆ©ç‡": 35,     # %
                "æ–°å¢åˆ©æ¶¦": 280,  # ç™¾ä¸‡å…ƒ
                "å…¨å¹´é¢„æœŸ": "æ‰­äºä¸ºç›ˆï¼Œå‡€åˆ©æ¶¦180-200ç™¾ä¸‡å…ƒ"
            },
            "ä¸­æ€§æƒ…æ™¯": {
                "æ–°å¢è®¢å•": 400,  # ç™¾ä¸‡å…ƒ
                "æ¯›åˆ©ç‡": 30,     # %
                "æ–°å¢åˆ©æ¶¦": 120,  # ç™¾ä¸‡å…ƒ
                "å…¨å¹´é¢„æœŸ": "å¤§å¹…å‡äºï¼Œå‡€åˆ©æ¶¦-20è‡³+20ç™¾ä¸‡å…ƒ"
            },
            "æ‚²è§‚æƒ…æ™¯": {
                "æ–°å¢è®¢å•": 150,  # ç™¾ä¸‡å…ƒ
                "æ¯›åˆ©ç‡": 25,     # %
                "æ–°å¢åˆ©æ¶¦": 37.5, # ç™¾ä¸‡å…ƒ
                "å…¨å¹´é¢„æœŸ": "å‡äºæœ‰é™ï¼Œå‡€åˆ©æ¶¦-60è‡³-80ç™¾ä¸‡å…ƒ"
            }
        }
        
        # ç»¼åˆç¼“å†²æ•ˆåº”è¯„åˆ†
        buffer_score = 0
        
        # åŸºäºæµ·å•¸å½±å“å¼ºåº¦
        buffer_score += 30  # æµ·å•¸å½±å“ç¡®å®å¼ºçƒˆ
        
        # åŸºäºäº§å“åŒ¹é…åº¦
        buffer_score += 25  # äº§å“é«˜åº¦åŒ¹é…
        
        # åŸºäºå…¬å¸æ‰§è¡Œèƒ½åŠ›
        buffer_score += 15  # å›½ä¼èƒŒæ™¯ï¼Œæ‰§è¡ŒåŠ›è¾ƒå¼º
        
        # åŸºäºæ—¶é—´çª—å£
        buffer_score += 20  # æ—¶é—´çª—å£åˆé€‚
        
        # åŸºäºå¸‚åœºé¢„æœŸ
        buffer_score += 10  # å¸‚åœºé¢„æœŸæ”¹å–„
        
        if buffer_score >= 80:
            buffer_effect = "å¼ºç¼“å†²æ•ˆåº”"
            st_delay_possibility = "å¾ˆå¯èƒ½å»¶ç¼“ST"
        elif buffer_score >= 60:
            buffer_effect = "ä¸­ç­‰ç¼“å†²æ•ˆåº”"
            st_delay_possibility = "å¯èƒ½å»¶ç¼“ST"
        elif buffer_score >= 40:
            buffer_effect = "å¼±ç¼“å†²æ•ˆåº”"
            st_delay_possibility = "ç¼“å†²æ•ˆæœæœ‰é™"
        else:
            buffer_effect = "æ— æ˜æ˜¾ç¼“å†²"
            st_delay_possibility = "éš¾ä»¥é¿å…ST"
        
        print("âœ… ç¼“å†²æ•ˆåº”ç­‰çº§: {}".format(buffer_effect))
        print("âœ… STå»¶ç¼“å¯èƒ½æ€§: {}".format(st_delay_possibility))
        print("âœ… ä¹è§‚æƒ…æ™¯: æ‰­äºä¸ºç›ˆï¼Œå‡€åˆ©æ¶¦180-200ç™¾ä¸‡å…ƒ")
        print("âœ… ä¸­æ€§æƒ…æ™¯: å¤§å¹…å‡äºï¼Œæ¥è¿‘ç›ˆäºå¹³è¡¡")
        
        return {
            "ç¼“å†²æ•ˆåº”": buffer_effect,
            "STå»¶ç¼“å¯èƒ½æ€§": st_delay_possibility,
            "ç¼“å†²è¯„åˆ†": buffer_score,
            "æœºåˆ¶åˆ†æ": buffer_mechanisms,
            "æƒ…æ™¯åˆ†æ": tsunami_revenue_boost
        }

    def investment_recommendation(self, st_risk, tsunami_impact, buffer_effect):
        """æŠ•èµ„å»ºè®®"""
        print("\nğŸ’¡ æŠ•èµ„å»ºè®® - {}".format(self.stock_name))
        print("-" * 50)
        
        # ç»¼åˆè¯„ä¼°
        risk_score = st_risk['é£é™©è¯„åˆ†']
        buffer_score = buffer_effect['ç¼“å†²è¯„åˆ†']
        
        combined_score = (buffer_score - (100 - risk_score)) / 2 + 50
        
        analysis = {
            "æ ¸å¿ƒåˆ¤æ–­": {
                "STé£é™©": st_risk['é£é™©ç­‰çº§'],
                "ç¼“å†²æ•ˆåº”": buffer_effect['ç¼“å†²æ•ˆåº”'],
                "æŠ•èµ„é€»è¾‘": "æµ·å•¸åº”æ€¥éœ€æ±‚vs STé€€å¸‚é£é™©åšå¼ˆ"
            },
            "æŠ•èµ„æœºä¼š": {
                "ä¸»é¢˜æŠ•èµ„": "åº”æ€¥æ•‘æ´æ¦‚å¿µè·å¾—å¸‚åœºå…³æ³¨",
                "ä¸šç»©å¼¹æ€§": "æµ·å•¸è®¢å•å¸¦æ¥ä¸šç»©å¤§å¹…æ”¹å–„å¯èƒ½",
                "æ”¿ç­–æ”¯æŒ": "å›½å®¶é‡è§†åº”æ€¥äº§ä¸šå‘å±•",
                "ä¼°å€¼ä¿®å¤": "ä¸šç»©é¢„æœŸæ”¹å–„æ¨åŠ¨ä¼°å€¼å›å‡"
            },
            "æŠ•èµ„é£é™©": {
                "STé£é™©": "è¿ç»­äºæŸé¢ä¸´STé£é™©",
                "ç›‘ç®¡é£é™©": "CSRCç«‹æ¡ˆè°ƒæŸ¥æœªç»“æŸ",
                "æ‰§è¡Œé£é™©": "è®¢å•è½¬åŒ–ä¸ºä¸šç»©å­˜åœ¨ä¸ç¡®å®šæ€§",
                "æ—¶é—´é£é™©": "æµ·å•¸å½±å“å¯èƒ½ä¸å¤ŸæŒç»­"
            }
        }
        
        # æŠ•èµ„å»ºè®®åˆ†çº§
        if combined_score >= 70:
            recommendation = "ç§¯æå…³æ³¨"
            position = "3-5%"
            strategy = "æµ·å•¸æ¦‚å¿µ+ä¸šç»©åè½¬åŒé‡é©±åŠ¨ï¼Œé€‚åˆçŸ­ä¸­æœŸå¸ƒå±€"
        elif combined_score >= 55:
            recommendation = "è°¨æ…å‚ä¸"
            position = "1-3%"
            strategy = "å°ä»“ä½åšå¼ˆæµ·å•¸ä¸»é¢˜ï¼Œä¸¥æ ¼æ­¢æŸ"
        elif combined_score >= 40:
            recommendation = "è§‚æœ›ä¸ºä¸»"
            position = "0-1%"
            strategy = "ç­‰å¾…æ›´æ˜ç¡®çš„ä¸šç»©æ”¹å–„ä¿¡å·"
        else:
            recommendation = "æš‚ä¸å»ºè®®"
            position = "0%"
            strategy = "STé£é™©è¿‡é«˜ï¼Œå»ºè®®å›é¿"
        
        print("âœ… æŠ•èµ„å»ºè®®: {}".format(recommendation))
        print("âœ… å»ºè®®ä»“ä½: {}".format(position))
        print("âœ… æŠ•èµ„ç­–ç•¥: {}".format(strategy))
        print("âš ï¸ æ ¸å¿ƒé£é™©: STé£é™©+ç›‘ç®¡è°ƒæŸ¥")
        
        return {
            "å»ºè®®": recommendation,
            "ä»“ä½": position,
            "ç­–ç•¥": strategy,
            "ç»¼åˆè¯„åˆ†": combined_score,
            "è¯¦ç»†åˆ†æ": analysis
        }

    def comprehensive_analysis(self):
        """ç»¼åˆåˆ†æ"""
        print("\n" + "="*60)
        print("ğŸ¯ ä¸­èˆ¹åº”æ€¥(300527) STé£é™©ä¸æµ·å•¸ç¼“å†²åˆ†æ")
        print("="*60)
        print("ğŸ“… åˆ†ææ—¶é—´ï¼š{}".format(datetime.now().strftime('%Y-%m-%d %H:%M:%S')))
        print("ğŸ” åˆ†æèƒŒæ™¯ï¼š2025å¹´7æœˆ30æ—¥ä¿„ç½—æ–¯8.8çº§åœ°éœ‡æµ·å•¸")
        
        # è·å–æ•°æ®
        data = self.get_financial_data()
        
        if not data:
            print("âŒ æ•°æ®è·å–å¤±è´¥ï¼Œæ— æ³•è¿›è¡Œæ·±åº¦åˆ†æ")
            return None
        
        # å„ç»´åº¦åˆ†æ
        st_risk = self.analyze_st_risk(data)
        tsunami_impact = self.analyze_tsunami_impact(data)
        buffer_effect = self.analyze_buffer_effect(st_risk, tsunami_impact)
        recommendation = self.investment_recommendation(st_risk, tsunami_impact, buffer_effect)
        
        # æ ¸å¿ƒç»“è®º
        print("\nğŸ¯ æ ¸å¿ƒç»“è®º")
        print("-" * 30)
        print("STé£é™©ç­‰çº§: {}".format(st_risk['é£é™©ç­‰çº§']))
        print("æµ·å•¸ç¼“å†²æ•ˆåº”: {}".format(buffer_effect['ç¼“å†²æ•ˆåº”']))
        print("æŠ•èµ„å»ºè®®: {}".format(recommendation['å»ºè®®']))
        print("å»ºè®®ä»“ä½: {}".format(recommendation['ä»“ä½']))
        
        return {
            "å…¬å¸ä¿¡æ¯": self.company_info,
            "STé£é™©åˆ†æ": st_risk,
            "æµ·å•¸å½±å“åˆ†æ": tsunami_impact,
            "ç¼“å†²æ•ˆåº”åˆ†æ": buffer_effect,
            "æŠ•èµ„å»ºè®®": recommendation
        }

def main():
    """ä¸»å‡½æ•°"""
    analyzer = CSScEmergencySTAnalyzer()
    result = analyzer.comprehensive_analysis()
    
    if result:
        # ä¿å­˜åˆ†ææŠ¥å‘Š
        timestamp = datetime.now().strftime('%Y%m%d_%H%M%S')
        filename = "ä¸­èˆ¹åº”æ€¥STé£é™©æµ·å•¸ç¼“å†²åˆ†æ_{}.json".format(timestamp)
        
        with open(filename, 'w', encoding='utf-8') as f:
            json.dump(result, f, ensure_ascii=False, indent=2, default=str)
        
        print("\nğŸ“„ è¯¦ç»†åˆ†ææŠ¥å‘Šå·²ä¿å­˜: {}".format(filename))
        print("\nğŸ‰ åˆ†æå®Œæˆï¼")

if __name__ == "__main__":
    main()