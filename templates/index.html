<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <title>äº¤æ˜“æ™ºèƒ½ä½“ - è‚¡ç¥¨åˆ†æç³»ç»Ÿ</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        body { 
            font-family: 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif; 
            max-width: 1200px; 
            margin: 0 auto; 
            padding: 20px; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        .container { 
            background: white; 
            padding: 25px; 
            border-radius: 15px; 
            margin: 20px 0; 
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }
        .analysis-container {
            background: white;
            padding: 25px;
            border-radius: 15px;
            margin: 20px 0;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            min-height: 400px;
        }
        .thinking-process {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin: 15px 0;
            border-left: 4px solid #28a745;
        }
        .agent-section {
            background: #fff3cd;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            border: 1px solid #ffeaa7;
        }
        .news-section {
            background: #e7f3ff;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            border: 1px solid #b3d8ff;
        }
        .technical-section {
            background: #f0fff4;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            border: 1px solid #90ee90;
        }
        .api-test { 
            background: #f8f9fa; 
            padding: 20px; 
            border-radius: 10px; 
            margin: 15px 0; 
            border-left: 4px solid #007cba;
        }
        .input-group {
            margin: 15px 0;
        }
        .input-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 5px;
            color: #2d3748;
        }
        button { 
            background: linear-gradient(45deg, #007cba, #0056b3); 
            color: white; 
            padding: 12px 24px; 
            border: none; 
            border-radius: 8px; 
            cursor: pointer; 
            font-size: 14px;
            transition: all 0.3s ease;
            margin: 5px;
        }
        button:hover { 
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,124,186,0.3);
        }
        button:disabled {
            background: #6c757d;
            cursor: not-allowed;
            transform: none;
        }
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #007cba;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        pre { 
            background: #2d3748; 
            color: #e2e8f0; 
            padding: 15px; 
            border-radius: 8px; 
            overflow-x: auto; 
            font-size: 13px;
            border: 1px solid #4a5568;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        input, select { 
            padding: 10px; 
            margin: 8px 0; 
            border: 2px solid #e2e8f0; 
            border-radius: 6px; 
            font-size: 14px;
            transition: border-color 0.3s ease;
            width: 100%;
            max-width: 300px;
        }
        input:focus, select:focus {
            outline: none;
            border-color: #007cba;
        }
        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            background: #48bb78;
            color: white;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
        }
        .recommendation {
            font-size: 1.2em;
            font-weight: bold;
            padding: 10px;
            border-radius: 8px;
            text-align: center;
            margin: 15px 0;
        }
        .buy { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .sell { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .hold { background: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }
        .progress-bar {
            width: 100%;
            height: 20px;
            background: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #007cba, #0056b3);
            transition: width 0.3s ease;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸ¤– æ™ºèƒ½äº¤æ˜“åŠ©æ‰‹</h1>
        <p>åŸºäºå¤šç»´åº¦åˆ†æçš„ä¸“ä¸šè‚¡ç¥¨æŠ•èµ„å»ºè®®ç³»ç»Ÿ</p>
    </div>
    
    <div class="container">
        <h2>ğŸ“Š ç³»ç»ŸçŠ¶æ€</h2>
        <p><strong>æœåŠ¡çŠ¶æ€:</strong> <span class="status-badge" id="status">åŠ è½½ä¸­...</span></p>
        <p><strong>ç‰ˆæœ¬:</strong> <span id="version">åŠ è½½ä¸­...</span></p>
        <p><strong>æœ€åæ›´æ–°:</strong> <span id="timestamp">åŠ è½½ä¸­...</span></p>
        <button onclick="refreshStatus()">ğŸ”„ åˆ·æ–°çŠ¶æ€</button>
        <button onclick="window.open('/ai-dashboard', '_blank')">ğŸ¤– AIåˆ†æä»ªè¡¨æ¿</button>
    </div>

    <div class="analysis-container">
        <h2>ğŸ“ˆ æ™ºèƒ½è‚¡ç¥¨åˆ†æ</h2>
        <div class="api-test">
            <div class="input-group">
                <label>è‚¡ç¥¨ä»£ç :</label>
                <input type="text" id="symbol" value="000001.SZ" placeholder="è¾“å…¥è‚¡ç¥¨ä»£ç  (å¦‚: 000001.SZ, 600036.SH)">
                <small>æ”¯æŒAè‚¡ä»£ç æ ¼å¼ï¼Œå¦‚ï¼š000001.SZ (å¹³å®‰é“¶è¡Œ)ï¼Œ600036.SH (æ‹›å•†é“¶è¡Œ)</small>
            </div>
            
            <div class="input-group">
                <label>åˆ†ææ—¥æœŸ:</label>
                <input type="date" id="date">
            </div>

            <div class="input-group">
                <label>åˆ†ææ¨¡å¼:</label>
                <select id="analysis-mode">
                    <option value="comprehensive">ç»¼åˆåˆ†æ (æ¨è)</option>
                    <option value="technical">æŠ€æœ¯åˆ†æ</option>
                    <option value="fundamental">åŸºæœ¬é¢åˆ†æ</option>
                    <option value="news">æ–°é—»æƒ…æ„Ÿåˆ†æ</option>
                </select>
            </div>
            
            <button id="analyze-btn" onclick="analyzeStock()">
                ğŸ” å¼€å§‹æ·±åº¦åˆ†æ
            </button>
            <button onclick="clearResults()">ğŸ—‘ï¸ æ¸…ç©ºç»“æœ</button>
            
            <div id="analysis-progress" style="display: none;">
                <h3>ğŸ§  åˆ†æè¿›åº¦</h3>
                <div class="progress-bar">
                    <div class="progress-fill" id="progress-fill" style="width: 0%"></div>
                </div>
                <p id="progress-text">å‡†å¤‡å¼€å§‹åˆ†æ...</p>
            </div>

            <div id="analysis-results" style="display: none;">
                <h3>ğŸ“‹ åˆ†æç»“æœ</h3>
                
                <div id="recommendation-section"></div>
                
                <div class="thinking-process">
                    <h4>ğŸ¤” æ™ºèƒ½ä½“æ€è€ƒè¿‡ç¨‹</h4>
                    <div id="thinking-content">åˆ†æå®Œæˆåå°†æ˜¾ç¤ºè¯¦ç»†çš„æ€è€ƒè¿‡ç¨‹...</div>
                </div>
                
                <div class="agent-section">
                    <h4>ğŸ‘¥ å¤šæ™ºèƒ½ä½“åˆ†æ</h4>
                    <div id="multi-agent-analysis">å¤šä¸ªä¸“ä¸šæ™ºèƒ½ä½“çš„åˆ†æè§‚ç‚¹...</div>
                </div>
                
                <div class="news-section">
                    <h4>ğŸ“° æ–°é—»æƒ…æ„Ÿåˆ†æ</h4>
                    <div id="news-analysis">ç›¸å…³æ–°é—»å’Œå¸‚åœºæƒ…æ„Ÿåˆ†æ...</div>
                </div>
                
                <div class="technical-section">
                    <h4>ğŸ“Š æŠ€æœ¯æŒ‡æ ‡åˆ†æ</h4>
                    <div id="technical-analysis">æŠ€æœ¯æŒ‡æ ‡å’Œå›¾è¡¨åˆ†æ...</div>
                </div>
                
                <details>
                    <summary>ğŸ”§ è¯¦ç»†æ•°æ® (JSON)</summary>
                    <pre id="raw-data">åŸå§‹åˆ†ææ•°æ®...</pre>
                </details>
            </div>
        </div>
    </div>

    <div class="container">
        <h2>ğŸ”§ API æµ‹è¯•å·¥å…·</h2>
        
        <div class="api-test">
            <h4>GET /health - å¥åº·æ£€æŸ¥</h4>
            <p>æ£€æŸ¥æœåŠ¡è¿è¡ŒçŠ¶æ€</p>
            <button onclick="testHealth()">æµ‹è¯•å¥åº·æ£€æŸ¥</button>
            <pre id="health-result">ç‚¹å‡»æµ‹è¯•...</pre>
        </div>
    </div>

    <script>
        let analysisInProgress = false;

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        window.onload = function() {
            refreshStatus();
            document.getElementById('date').value = new Date().toISOString().split('T')[0];
        }

        function refreshStatus() {
            fetch('/api/info')
                .then(response => response.json())
                .then(data => {
                    document.getElementById('status').textContent = 'è¿è¡Œä¸­';
                    document.getElementById('version').textContent = data.version || '1.0.0';
                    document.getElementById('timestamp').textContent = new Date(data.timestamp).toLocaleString('zh-CN');
                })
                .catch(error => {
                    console.error('çŠ¶æ€è·å–å¤±è´¥:', error);
                    document.getElementById('status').textContent = 'è¿æ¥å¤±è´¥';
                });
        }

        function testHealth() {
            fetch('/health')
                .then(response => response.json())
                .then(data => {
                    document.getElementById('health-result').textContent = JSON.stringify(data, null, 2);
                })
                .catch(error => {
                    document.getElementById('health-result').textContent = 'é”™è¯¯: ' + error.message;
                });
        }

        function analyzeStock() {
            if (analysisInProgress) return;

            const symbol = document.getElementById('symbol').value.trim();
            const date = document.getElementById('date').value;
            const mode = document.getElementById('analysis-mode').value;
            
            if (!symbol) {
                alert('è¯·è¾“å…¥è‚¡ç¥¨ä»£ç ');
                return;
            }

            // å¼€å§‹åˆ†æ
            analysisInProgress = true;
            const analyzeBtn = document.getElementById('analyze-btn');
            analyzeBtn.disabled = true;
            analyzeBtn.innerHTML = '<div class="loading"></div>æ­£åœ¨åˆ†æ...';

            // æ˜¾ç¤ºè¿›åº¦æ¡
            document.getElementById('analysis-progress').style.display = 'block';
            document.getElementById('analysis-results').style.display = 'none';

            // æ¨¡æ‹Ÿè¿›åº¦æ›´æ–°
            simulateProgress();

            // å‘é€åˆ†æè¯·æ±‚
            fetch('/analyze', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    symbol: symbol.toUpperCase(),
                    date: date,
                    mode: mode,
                    detailed: true
                })
            })
            .then(response => response.json())
            .then(data => {
                displayAnalysisResults(data);
            })
            .catch(error => {
                document.getElementById('analysis-results').innerHTML = 
                    '<div style="color: red;">åˆ†æå¤±è´¥: ' + error.message + '</div>';
                document.getElementById('analysis-results').style.display = 'block';
            })
            .finally(() => {
                analysisInProgress = false;
                analyzeBtn.disabled = false;
                analyzeBtn.innerHTML = 'ğŸ” å¼€å§‹æ·±åº¦åˆ†æ';
                document.getElementById('analysis-progress').style.display = 'none';
            });
        }

        function simulateProgress() {
            const steps = [
                { progress: 10, text: 'è¿æ¥æ•°æ®æº...' },
                { progress: 25, text: 'è·å–è‚¡ç¥¨åŸºæœ¬ä¿¡æ¯...' },
                { progress: 40, text: 'åˆ†ææŠ€æœ¯æŒ‡æ ‡...' },
                { progress: 60, text: 'æœç´¢ç›¸å…³æ–°é—»...' },
                { progress: 80, text: 'å¤šæ™ºèƒ½ä½“ååŒåˆ†æ...' },
                { progress: 95, text: 'ç”ŸæˆæŠ•èµ„å»ºè®®...' },
                { progress: 100, text: 'åˆ†æå®Œæˆ!' }
            ];

            let currentStep = 0;
            const interval = setInterval(() => {
                if (currentStep < steps.length && analysisInProgress) {
                    const step = steps[currentStep];
                    document.getElementById('progress-fill').style.width = step.progress + '%';
                    document.getElementById('progress-text').textContent = step.text;
                    currentStep++;
                } else {
                    clearInterval(interval);
                }
            }, 1000);
        }

        function displayAnalysisResults(data) {
            // æ˜¾ç¤ºæ¨èç»“æœ
            const recommendation = data.analysis?.recommendation || 'HOLD';
            const recommendationClass = recommendation.toLowerCase();
            const recommendationText = {
                'BUY': 'ğŸš€ ä¹°å…¥',
                'SELL': 'ğŸ“‰ å–å‡º', 
                'HOLD': 'âš–ï¸ æŒæœ‰'
            }[recommendation] || 'âš–ï¸ æŒæœ‰';

            document.getElementById('recommendation-section').innerHTML = 
                '<div class="recommendation ' + recommendationClass + '">' + 
                recommendationText + ' - ç½®ä¿¡åº¦: ' + (data.analysis?.confidence || 0.75) + '</div>';

            // æ˜¾ç¤ºæ€è€ƒè¿‡ç¨‹
            document.getElementById('thinking-content').innerHTML = 
                data.thinking_process || 'æ™ºèƒ½ä½“æ­£åœ¨æ·±åº¦æ€è€ƒä¸­...';

            // æ˜¾ç¤ºå¤šæ™ºèƒ½ä½“åˆ†æ
            document.getElementById('multi-agent-analysis').innerHTML = 
                formatMultiAgentAnalysis(data.multi_agent_analysis);

            // æ˜¾ç¤ºæ–°é—»åˆ†æ
            document.getElementById('news-analysis').innerHTML = 
                formatNewsAnalysis(data.news_analysis);

            // æ˜¾ç¤ºæŠ€æœ¯åˆ†æ
            document.getElementById('technical-analysis').innerHTML = 
                formatTechnicalAnalysis(data.technical_indicators);

            // æ˜¾ç¤ºåŸå§‹æ•°æ®
            document.getElementById('raw-data').textContent = JSON.stringify(data, null, 2);

            document.getElementById('analysis-results').style.display = 'block';
        }

        function formatMultiAgentAnalysis(data) {
            if (!data) return 'å¤šæ™ºèƒ½ä½“åˆ†ææ•°æ®æš‚ä¸å¯ç”¨';
            
            let html = '<ul>';
            Object.entries(data).forEach(([agent, analysis]) => {
                html += '<li><strong>' + agent + ':</strong> ' + analysis + '</li>';
            });
            html += '</ul>';
            return html;
        }

        function formatNewsAnalysis(data) {
            if (!data) return 'æ–°é—»åˆ†ææ•°æ®æš‚ä¸å¯ç”¨';
            
            return '<p><strong>æƒ…æ„Ÿå¾—åˆ†:</strong> ' + (data.sentiment_score || 'N/A') + '</p>' +
                   '<p><strong>ç›¸å…³æ–°é—»æ•°é‡:</strong> ' + (data.news_count || 0) + '</p>' +
                   '<p><strong>ä¸»è¦è§‚ç‚¹:</strong> ' + (data.summary || 'æš‚æ— ') + '</p>';
        }

        function formatTechnicalAnalysis(data) {
            if (!data) return 'æŠ€æœ¯åˆ†ææ•°æ®æš‚ä¸å¯ç”¨';
            
            let html = '<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px;">';
            Object.entries(data).forEach(([indicator, value]) => {
                html += '<div><strong>' + indicator + ':</strong> ' + value + '</div>';
            });
            html += '</div>';
            return html;
        }

        function clearResults() {
            document.getElementById('analysis-results').style.display = 'none';
            document.getElementById('analysis-progress').style.display = 'none';
        }
    </script>
</body>
</html>
